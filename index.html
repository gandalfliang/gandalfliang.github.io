<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>gandalfliang的个人博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="gandalfliang的个人博客">
<meta property="og:url" content="https://gandalfliang.github.io/index.html">
<meta property="og:site_name" content="gandalfliang的个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gandalfliang的个人博客">
    

    
        <link rel="alternate" href="/atom.xml" title="gandalfliang的个人博客" type="application/atom+xml" />
    

    
        <link rel="icon" href="/avatar.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">gandalfliang的个人博客</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://avatars3.githubusercontent.com/u/5707551?v=3&amp;s=460" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://avatars3.githubusercontent.com/u/5707551?v=3&amp;s=460" />
            <h2 id="name">Gandalfliang</h2>
            <h3 id="title">gandalfliang@outlook.com</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Guangzhou, China, 单身</span>
            <!-- <a id="follow" target="_blank" href="undefined">关注我</a> -->
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                22
                <span>文章</span>
            </div>
            <div class="article-info-block">
                39
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/gandalfliang" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/atom.xml" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-csharp-memory-model-part-1" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/12/26/csharp-memory-model-part-1/">C# 内存模型</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/12/26/csharp-memory-model-part-1/">
            <time datetime="2018-12-26T07:43:56.000Z" itemprop="datePublished">2018-12-26</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/C/">C#</a>, <a class="tag-link" href="/tags/Volatile/">Volatile</a>, <a class="tag-link" href="/tags/内存模型/">内存模型</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><p>在 C# 的语言规范中 <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-334.pdf">ECMA-334</a>，对于<code>Volatile</code>关键字的描述：</p>
<blockquote>
<p><em>15.5.4 Volatile fields<br>When a field-declaration includes a volatile modifier, the fields introduced by that declaration are volatile fields. For non-volatile fields, optimization techniques that reorder instructions can lead to unexpected and unpredictable results in multi-threaded programs that access fields without synchronization such as that provided by the lock-statement (§13.13). These optimizations can be<br>performed by the compiler, by the run-time system, or by hardware. For volatile fields, such reordering optimizations are restricted:</em></p>
<ul>
<li><em>A read of a volatile field is called a volatile read. A volatile read has “acquire semantics”; that is, it is guaranteed to occur prior to any references to memory that occur after it in the instruction sequence.</em>  </li>
<li><em>A write of a volatile field is called a volatile write. A volatile write has “release semantics”; that is, it is guaranteed to happen after any memory references prior to the write instruction in the instruction sequence.</em></li>
</ul>
</blockquote>
<p>简单来说，对于常规字段，由于代码优化而导致指令顺序改变，如果没有进行一定的同步控制，在多线程应用中可能会导致意想不到的结果，而造成这种意外的原因可能是编译器优化、运行时系统的优化或者因为硬件的原因（即CPU和主存储器的通信模型）。可变(volatile)字段会限制这种优化的发生，在这里引入两个定义：</p>
<ul>
<li><p>可变读： 对于可变字段的读操作会<code>获取语义</code>。即，其可以保证对于可变字段的内存读取操作一定发生在其后内存操作指令的前面。进一步解释，与 <strong>Thread.MemoryBarrier</strong> 类似，获取语义会保证在读取可变字段指令前的指令可以跨越它出现在它后面，但是相反地，在它后面的指令不能跨越它出现在它的前面。例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Volatile_class</span></div><div class="line"></span>&#123;</div><div class="line">    private int _a;</div><div class="line">    private volatile int _b;</div><div class="line">    private int _c;</div><div class="line"></div><div class="line">    private <span class="keyword">void</span> Call()</div><div class="line">    &#123;</div><div class="line">        int temp=_a;</div><div class="line">        <span class="comment">//由于_b是可变字段，这样可以保证编译器不会将temp2=_c的指令提前到其之前</span></div><div class="line">        <span class="comment">//但是，可以将temp=_a提到其之后</span></div><div class="line">        int temp1=_b;</div><div class="line">        int temp2=_c;</div><div class="line"></div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private <span class="keyword">void</span> OtherCall()&#123;...&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>可变写： 对于可变字段的写操作会<code>释放语义</code>。即，其可以保证对于可变字段的写操作发生在其前面指令执行之后，但是在它之后的指令可以跨域它提前执行。</p>
</li>
</ul>
<h2 id="X86-X64"><a href="#X86-X64" class="headerlink" title="X86_X64"></a>X86_X64</h2><p>现代的 x86_x64 CPU 可以保证字段的读写都是 “volatile” 的，即你不会读取到旧的字段值，这是由  CPU 提供保证的。这样看起来好像与上面的描述存在矛盾，如果 CPU 可以保证所有字段的读写都是 <em>volatile</em> ,那为什么还需要在语言层面提供<code>volatile</code>关键字。其实这是两个不同的概念，CPU 从硬件层面上保证了对内存的读写是实时的，你不会读取到 Stale Value ,无论这个字段是常规字段还是可变字段。而语言层面上的 <code>volatile</code> 只是一个关键字，告诉编译器不能对该字段进行 <strong>instruction reorder</strong> 等可能导致多线程读写出现不符合预期结果的优化(暂且这样理解)。</p>
<p>参考这段代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Program</span></div><div class="line"></span>&#123;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">infinity_loop</span></div><div class="line">    </span>&#123;</div><div class="line">        public bool Terminated;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">void</span> Main(string[] args)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> loop=<span class="keyword">new</span> infinity_loop();</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Thread(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">            loop.Terminated=<span class="literal">true</span>;</div><div class="line">        &#125;).Start();</div><div class="line"></div><div class="line">        <span class="keyword">while</span>(!loop.Terminated);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用 dotnet core Release 模式运行这段代码，可以发现它永远也不会退出，分析汇编代码：<br></p>
            <p class="article-more-link">
                <a href="/2018/12/26/csharp-memory-model-part-1/#more">查看更多</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-tail-recursion" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/08/23/tail-recursion/">C# 尾递归优化</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/08/23/tail-recursion/">
            <time datetime="2018-08-22T16:41:31.000Z" itemprop="datePublished">2018-08-23</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/C/">C#</a>, <a class="tag-link" href="/tags/尾递归/">尾递归</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h2 id="何为尾递归"><a href="#何为尾递归" class="headerlink" title="何为尾递归"></a><strong>何为尾递归</strong></h2><p>有时候我们使用递归来解决一些特定的问题，但是使用递归需要注意不要导致栈溢出，这是使用递归的一个常见问题，对于规模足够大的问题，使用递归必定会导致栈溢出。通常，我们可以通过尾递归进行优化，尾递归可以避免栈溢出的问题（暂且这样认为）。<br>尾递归并不是什么新奇的东西，理解起来很简单，对于递归，如果上层调用的返回结果不依赖子调用的结果，那么，这就是一个尾递归。例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">///这是一个简单的尾递归例子</span></div><div class="line">namespace tail</div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Program</span></div><div class="line">    </span>&#123;</div><div class="line">        <span class="keyword">static</span> <span class="keyword">void</span> Main(string[] args)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">var</span> test=RetrieveData(<span class="number">100000000000000</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">static</span> long RetrieveData(long unit)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (unit == <span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> unit;</div><div class="line">            <span class="keyword">return</span> RetrieveData(--unit);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="等等，好像有什么地方不对"><a href="#等等，好像有什么地方不对" class="headerlink" title="等等，好像有什么地方不对"></a><strong>等等，好像有什么地方不对</strong></h2><p>从上面的例子分析，代码依旧会导致栈溢出，不是吗？是的，聪明的你答对了。那为什么说尾递归可以避免栈溢出问题？当然，从刚才的结论看，这个问题提的并不准确，尾递归并不能避免栈溢出问题。<br>仔细想想，尾递归结构和循环结构是类似的，上面的尾递归可以写成：<br></p>
            <p class="article-more-link">
                <a href="/2018/08/23/tail-recursion/#more">查看更多</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-filtering-in-business-logic" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/07/16/filtering-in-business-logic/">业务逻辑中的 Filter</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/07/16/filtering-in-business-logic/">
            <time datetime="2018-07-16T03:50:00.000Z" itemprop="datePublished">2018-07-16</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/design-pattern/">design pattern</a>, <a class="tag-link" href="/tags/filter/">filter</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="Pipe-and-Filter"><a href="#Pipe-and-Filter" class="headerlink" title="Pipe and Filter"></a>Pipe and Filter</h2><p>在一些应用的开发场景中，例如，大量的数据处理、需要对数据进行大量的转换和过滤，使用管道和<code>Filter</code>是一个很好的选择。对于这种应用场景，一般都需要处理业务足够灵活，并且足够健壮。想象一下，为了实现相应的过滤功能，使用大量的<code>if</code>或者<code>switch case</code>,日后维护这套代码的人估计也会抓狂的吧，单元测试编写起来，应该也够呛吧。</p>
<h2 id="用Filter来处理业务"><a href="#用Filter来处理业务" class="headerlink" title="用Filter来处理业务"></a>用<code>Filter</code>来处理业务</h2><p>Filter一般都被认为是用来处理数据的，其实，更近一步，用来”处理”业务，也不失为一种好办法。当然，这里的处理，并不是说在Filter中执行业务，考虑到业务都是一些耗时（但不绝对）的操作，在管道中处理业务是不对的，这样会堵塞整条管道。相反地，我们的业务依赖管道中的数据，我们希望在数据处理的过程中，由数据的处理来触发特定的业务，因此，我们定义一种BusinessFilter，其不对数据进行处理，而是作为一种窥探，“假装”自己是在进行数据处理，实际是根据数据的实际来通知外界做相应的业务而已。<br><img src="/2018/07/16/filtering-in-business-logic/pipe.png" alt="pipe.png" title="">  </p>
<h2 id="灵活性"><a href="#灵活性" class="headerlink" title="灵活性"></a>灵活性</h2><p>正如上图的结构，搭积木式的链式结构可以根据业务的调整进行对应的调整，不同的业务可以在通道中穿插。从另一个方面可以看出，我们设计Filter的时候，保持它的独立性是至关重要的，一个Filter完成一个工作，而且不受其他Filter影响是保持整个链式结构灵活的关键。</p>
<h2 id="健壮性"><a href="#健壮性" class="headerlink" title="健壮性"></a>健壮性</h2><p>一般来说，管道/Filter结构一旦确定，会做大调整的几率都不高。由于Filter的存在，所有的变动在改动之前就可以确定影响范围，而且可以限制调整带来的结构变动。</p>
<h2 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h2><ul>
<li>几乎所有的Pipe/Filter结构都是线性结构，这种情况限制了async/await的应用</li>
<li>如果一个Filter只接受一种数据类型，那么存在的数据转换会降低我们系统的性能，特别地，如果是C#，进行引用类型和值类型的转换，频繁的装箱拆箱也会降低我们系统的性能；为了解决这种问题，限制Filter可接受的数据类型，这样就不能随意连接Filter到所有数据类型，通用性降低。</li>
<li>…</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-debugging-mlt" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/06/01/debugging-mlt/">使用 IDE 编译调试 Mlt framework</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/06/01/debugging-mlt/">
            <time datetime="2018-06-01T05:32:41.000Z" itemprop="datePublished">2018-06-01</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Mlt-Framework/">Mlt Framework</a>, <a class="tag-link" href="/tags/Visual-Studio/">Visual Studio</a>, <a class="tag-link" href="/tags/Xcode/">Xcode</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><a href="https://www.mltframework.org/" target="_blank" rel="external"><code>Mlt framework</code></a> 是一个开源跨平台的多媒体处理框架，使用模块化的设计，集成了大量的业界领先的视频处理框架，如ffmpeg，良好的设计，可以方便的集成自己的模块进去，利用它，你可以实现自己的 Adobe Premiere 等非线性多媒体编辑软件或者视频播放器，简单几句代码为视频添加炫酷的转场效果和滤镜。 </p>
<p>由于跨平台，项目通过configure的方式来管理工程，对于学习来说多媒体框架来说，调试起来并不方便，我整理了CMake的脚本，可以通过cmake来生成我们熟悉的 Visual Studio 或者 Xcode<br>工程，方便调试。  </p>
<p>在阅读下面文章之前，请确保你有一定的 MinGW 工具链使用经验。 </p>
<h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3><p><a href="https://github.com/gandalfliang/mlt" target="_blank" rel="external">https://github.com/gandalfliang/mlt</a><br>分支：cmake</p>
<h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><p>对于 Windows 平台：  </p>
<ol>
<li>cmake</li>
<li>MinGW </li>
<li>msys2</li>
<li>Windows SDK  </li>
</ol>
<p>确保MinGW和msys2里的工具链路径在系统变量PATH中</p>
<p>Mac 平台：</p>
<ol>
<li>Xcode  </li>
</ol>
<h3 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h3><p>在工程跟目录，运行脚本（如果是 Windows 平台，从开发者命令行工具运行）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">py bootstrap.py</div></pre></td></tr></table></figure></p>
<p>如果一切顺利，工程文件将会在 <code>build/win32</code> 或者 <code>build/mac</code> 下。脚本运行要拉取ffmpeg的源码并configure，这是一个耗时的工作。在Windows平台下configure ffmpeg将是一个漫长的等待，没事的话，去喝杯咖啡，或者有空的时候在命令窗里敲一下enter键，可能会有收获哦。</p>
<p>完成后，你就可以愉快的调试这个框架了。 </p>
<img src="/2018/06/01/debugging-mlt/mac.png" alt="mac.png" title="">
        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-debug_mlt_vscode" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/04/17/debug_mlt_vscode/">Debug Mlt Framework in VSCode</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/04/17/debug_mlt_vscode/">
            <time datetime="2018-04-16T17:21:38.000Z" itemprop="datePublished">2018-04-17</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/图片/">图片</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Mlt-Framework/">Mlt Framework</a>, <a class="tag-link" href="/tags/VSCode/">VSCode</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="Debugging-Mlt-framework-in-VSCode"><a href="#Debugging-Mlt-framework-in-VSCode" class="headerlink" title="Debugging Mlt framework in VSCode"></a><code>Debugging Mlt framework in VSCode</code></h2><img src="/2018/04/17/debug_mlt_vscode/mlt_vscode.png" alt="mlt_vscode.png" title="">
<p>Crossing platform with built in tool chain</p>
<img src="/2018/04/17/debug_mlt_vscode/mlt_vscode_osx.png" alt="mlt_vscode_osx.png" title="">  
<p>Coming up soon (maybe)</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-Gitsoler1_1" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/03/21/Gitsoler1_1/">Gitsoler</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/03/21/Gitsoler1_1/">
            <time datetime="2018-03-21T03:01:38.000Z" itemprop="datePublished">2018-03-21</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/工具/">工具</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Extension/">Extension</a>, <a class="tag-link" href="/tags/Visual-Studio/">Visual Studio</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="Gitsoler-1-1-Split-View-supported-https-marketplace-visualstudio-com-items-itemName-gandalfliang-gitsoler"><a href="#Gitsoler-1-1-Split-View-supported-https-marketplace-visualstudio-com-items-itemName-gandalfliang-gitsoler" class="headerlink" title="Gitsoler 1.1 - Split View supported: https://marketplace.visualstudio.com/items?itemName=gandalfliang.gitsoler"></a>Gitsoler 1.1 - Split View supported: <a href="https://marketplace.visualstudio.com/items?itemName=gandalfliang.gitsoler" target="_blank" rel="external">https://marketplace.visualstudio.com/items?itemName=gandalfliang.gitsoler</a></h1>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-transparent_4k_window.translate" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/02/16/transparent_4k_window.translate/">【翻译】关于 WPF 透明窗口的内存占用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/02/16/transparent_4k_window.translate/">
            <time datetime="2018-02-16T15:01:38.000Z" itemprop="datePublished">2018-02-16</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/翻译/">翻译</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/LayeredWindow/">LayeredWindow</a>, <a class="tag-link" href="/tags/Performance/">Performance</a>, <a class="tag-link" href="/tags/WPF/">WPF</a>, <a class="tag-link" href="/tags/翻译/">翻译</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>翻译自己的文章才是最骚的。。。  <a href="https://gandalfliang.github.io/2018/01/17/transparent_4k_window/">Origin Post</a></p>
<hr>
<p>要实现一个透明的 WPF 窗口？<br>多么简单的一个任务啊！只要设置 AllowTransparency 和 WindowStyle，你可以在毫秒间完成这个任务。  </p>
<p><code>AllowTransparency=&quot;True&quot; WindowStyle=&quot;None&quot; Background=&quot;Transparent&quot;</code>   </p>
<p>正确吧？当然。<br>但是（你懂得），打开你的任务管理器看看，简单的任务通常会带来大量的内存占用，特别是4K分辨率的透明窗口。100+ MB的内存被浪费了，就只为了显示一个空白的透明窗口！这是不可接受的。一年前，如果你说：”谁关心内存呀，现在的内存条太便宜了”，你可能是对的。但是查查这一年内存条的价格走向，它们现在贵上天了。</p>
<h2 id="WPF-透明窗口的有趣小真相"><a href="#WPF-透明窗口的有趣小真相" class="headerlink" title="WPF 透明窗口的有趣小真相"></a>WPF 透明窗口的有趣小真相</h2><ul>
<li><code>内存占用随着窗口尺寸增大而增加</code></li>
<li><code>Win32 窗口没有这样的问题</code>  </li>
</ul>
<p>等等，什么？窗口越大，内存消耗的更多？嗯。。。这看起来很熟悉嘛，就像一个<code>Bitmap</code>。知道现在，我们并不知道 WPF 是如何处理透明窗口的，但是这种症状显示它就好像直接将整个桌面作为一个位图，然后窗口用这张位图的重叠部分作为其背景来更新自己，让它看起来是“透明”的。多么聪明的做法呀。。。<br>在 WPF 刚刚发布的那些日子里，低分辨率的计算机屏幕占据主流位置，即使在今天，大多数的笔记本电脑依然带着一块1366*768分辨率的屏幕被推向市场（离谱吧）。让我们唾弃那些OEM厂商讲的毫无根据的废话并且思考一下运行在高分辨率下的程序的情况。  </p>
<h2 id="内存并不是免费的，不要浪费之"><a href="#内存并不是免费的，不要浪费之" class="headerlink" title="内存并不是免费的，不要浪费之"></a>内存并不是免费的，不要浪费之</h2><p>很显然，浪费100+MB的内存来显示一个4K的透明窗口是不可接受的，特别是和 Win32 窗口只占用10+MB的内存进行比较时。这差距让 WPF 看起来蠢透了。<br>抱怨已经够多了，想想对此我们能做什么呢？我可不想用C++和GDI将我的UI代码重写一遍，这太没效率并且也跟不上时代，况且，没人会为此“区区小事”去放弃他们漂亮、易于维护的Xaml UI代码。  </p>
<h2 id="使用-Win32-承载-WPF-内容"><a href="#使用-Win32-承载-WPF-内容" class="headerlink" title="使用 Win32 承载 WPF 内容"></a>使用 Win32 承载 WPF 内容</h2><p>好吧，确实，没人愿意为了区区90MB内存去重写它们的UI。与使用C++重写UI所耗费的精力相比，这个内存的占用差距看起来是可以接受的（#笑脸）。但是请记住，我们一如既往的可以在 Win32 窗口中承载 WPF 的内容。<br>例如，我们想创建一个全屏、半透明背景带着非透明内容的对话框。为了规避 WPF 透明窗口的内存问题，我们可以使用 Win32 创建一个半透明的窗口：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">DWORD Flags1 = WS_EX_LAYERED;</div><div class="line">DWORD Flags2 = WS_POPUP;</div><div class="line"></div><div class="line">HWND hWnd = CreateWindowEx(Flags1,szWindowClass, szTitle, Flags2,</div><div class="line">    CW_USEDEFAULT, <span class="number">0</span>, <span class="number">3840</span>,<span class="number">2160</span>, nullptr, nullptr, hInstance, nullptr);</div><div class="line"></div><div class="line">SetLayeredWindowAttributes(hWnd, RRR, (BYTE)<span class="number">125</span>, LWA_ALPHA);</div><div class="line">ShowWindow(hWnd, nCmdShow);</div><div class="line">UpdateWindow(hWnd);</div><div class="line"></div><div class="line"><span class="keyword">case</span> WM_ERASEBKGND:</div><div class="line">    RECT rect;</div><div class="line">    GetClientRect(hWnd, &amp;rect);</div><div class="line">    FillRect((HDC)wParam, &amp;rect, CreateSolidBrush(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)));</div><div class="line">    <span class="keyword">break</span>;</div></pre></td></tr></table></figure></p>
<p>通过启用 <code>C++/CLI</code>，我们可以直接访问 WPF 内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">namespace ManagedCode</div><div class="line">&#123;</div><div class="line">    using namespace System;</div><div class="line">    using namespace System::Windows;</div><div class="line">    using namespace System::Windows::Interop;</div><div class="line">    using namespace System::Windows::Media;</div><div class="line"></div><div class="line">    HWND GetHwnd(HWND parent, int x, int y, int width, int height) &#123;</div><div class="line">    HwndSource^ source = gcnew HwndSource(</div><div class="line">        <span class="number">0</span>, <span class="comment">// class style  </span></div><div class="line">        WS_VISIBLE | WS_CHILD, <span class="comment">// style  </span></div><div class="line">        <span class="number">0</span>, <span class="comment">// exstyle  </span></div><div class="line">        x, y, width, height,</div><div class="line">        <span class="string">"hi"</span>, <span class="comment">// NAME  </span></div><div class="line">        IntPtr(parent)        <span class="comment">// parent window   </span></div><div class="line">    );</div><div class="line"></div><div class="line">    UIElement^ page = gcnew ManagedContent::WPFContent();</div><div class="line">    source-&gt;RootVisual = page;</div><div class="line">    <span class="keyword">return</span> (HWND)source-&gt;Handle.ToPointer();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//managed content</span></div><div class="line">ManagedCode::GetHwnd(hWnd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</div></pre></td></tr></table></figure>
<p>由于 WPF 和 GDI 背后的技术不尽相同，还有更多的工作需要做来解决不可避免的透明通道问题，但是，为了方便，你始终可以使用 Popup 来实现你的目标。</p>
<hr>
<p>Macbook Pro 2016 的键盘真垃圾。。。。。。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-lightweighted_shadoweffect" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/02/12/lightweighted_shadoweffect/">Light Weighted DropshadowEffect</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/02/12/lightweighted_shadoweffect/">
            <time datetime="2018-02-12T05:58:27.000Z" itemprop="datePublished">2018-02-12</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/OpenCL/">OpenCL</a>, <a class="tag-link" href="/tags/图像处理/">图像处理</a>, <a class="tag-link" href="/tags/高性能计算/">高性能计算</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>Let’s create a light weighted wpf drop shadow effect, considering that the origin one performs badly in some special occasions.<br>As I mentioned before (<a href="https://gandalfliang.github.io/2017/09/20/WPF_rendering_perf/">check it out</a>), the original WPF DropShadow Effect can cause severe preformance problem. Due to the “flaw” M$FT brought to the HLSL support for WPF, the Effect class that implements the visual effect creates and destroy GPU resource each frame, which is the worst thing you could do with GPU resources. So, what about implementing a custom shadow effect to avoid it? This sounds interesting.  </p>
<p>– 春节补充</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-transparent_4k_window" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/01/17/transparent_4k_window/">关于 WPF 透明窗口的内存占用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/01/17/transparent_4k_window/">
            <time datetime="2018-01-17T03:01:38.000Z" itemprop="datePublished">2018-01-17</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/LayeredWindow/">LayeredWindow</a>, <a class="tag-link" href="/tags/Performance/">Performance</a>, <a class="tag-link" href="/tags/WPF/">WPF</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>要实现一个透明的 WPF 窗口？<br>What an easy task! By setting AllowTransparency and WindowStyle, you could finish it in seconds.   </p>
<p><code>AllowTransparency=&quot;True&quot; WindowStyle=&quot;None&quot; Background=&quot;Transparent&quot;</code>   </p>
<p>Correct? Of course.  </p>
<p>However (you know this is coming), look at your task manager, easy task comes with large memory consumption, especially for 4K transparent window. 100+ MB ram are wasted for just showing an empty, transparent window! That’s unacceptable. A year ago, you might be right saying “Who cares about RAM, they are cheap as hell”, but check out the price they’ve grown over this year, they are expensive as hell now.  </p>
<h2 id="Fun-fact-of-WPF-transparent-window"><a href="#Fun-fact-of-WPF-transparent-window" class="headerlink" title="Fun fact of WPF transparent window"></a>Fun fact of WPF transparent window</h2><ul>
<li><code>RAM usage increase as window size enlarge</code>  </li>
<li><code>Win32 window has no such problem</code>  </li>
</ul>
<p>Wait, what? The larger the window is, the more RAM it consumes? Hmmmmm… this looks familiar, just like a <code>Bitmap</code>. For now, we don’t know how WPF handles transparent window, but the symptom shows that it’s like using the whole screen as a bitmap and the window updating itself with portion of that bitmap, making it “transparent”. What a smart move…<br>Back in the days when WPF was first released, low screen resolution was the main stream. Even today, most laptops still are shipping with a monitor of 1366*768 (ridiculous, right?). Let’s despise the nonsense the OEM told us and think about program running in computers with higher screen resolution. </p>
<h2 id="RAM-is-not-free-do-not-waste-it"><a href="#RAM-is-not-free-do-not-waste-it" class="headerlink" title="RAM is not free, do not waste it"></a>RAM is not free, do not waste it</h2><p>Obviously, costing 100+ mb of ram for showing a transparent window in 4K is unacceptable, especially compared with Win32 transparent window, which costs only 10+ mb. The gap between them makes WPF look dump.<br>Enough complaining, what can we do about it? I don’t want to write UI code with GDI using C++, that’s inefficient and not modern, plus, no one would abandon their beautiful, easy to maintain xaml UI code for this.</p>
<h2 id="Hosting-WPF-content-in-Win32-Window"><a href="#Hosting-WPF-content-in-Win32-Window" class="headerlink" title="Hosting WPF content in Win32 Window"></a>Hosting WPF content in Win32 Window</h2><p>Well, indeed, no one would rewrite their UI code for just about 90mb of RAM. Compared with the work needed to rewrite C++ UI code, the RAM consumption gap seems acceptable (#smile face). But please remember, we can always host WPF content in win32 window.<br>Let say, we want to create a full screen notification dialog with semi-transparent background and apaque notication content in the center. To avoid the WPF ram problem, we create a semi-transparent window using win32:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">DWORD Flags1 = WS_EX_LAYERED;</div><div class="line">DWORD Flags2 = WS_POPUP;</div><div class="line"></div><div class="line">HWND hWnd = CreateWindowEx(Flags1,szWindowClass, szTitle, Flags2,</div><div class="line">    CW_USEDEFAULT, <span class="number">0</span>, <span class="number">3840</span>,<span class="number">2160</span>, nullptr, nullptr, hInstance, nullptr);</div><div class="line"></div><div class="line">SetLayeredWindowAttributes(hWnd, RRR, (BYTE)<span class="number">125</span>, LWA_ALPHA);</div><div class="line">ShowWindow(hWnd, nCmdShow);</div><div class="line">UpdateWindow(hWnd);</div><div class="line"></div><div class="line"><span class="keyword">case</span> WM_ERASEBKGND:</div><div class="line">    RECT rect;</div><div class="line">    GetClientRect(hWnd, &amp;rect);</div><div class="line">    FillRect((HDC)wParam, &amp;rect, CreateSolidBrush(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)));</div><div class="line">    <span class="keyword">break</span>;</div></pre></td></tr></table></figure></p>
<p>By enabling <code>C++/CLI</code>, we can access WPF content directly  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">namespace ManagedCode</div><div class="line">&#123;</div><div class="line">    using namespace System;</div><div class="line">    using namespace System::Windows;</div><div class="line">    using namespace System::Windows::Interop;</div><div class="line">    using namespace System::Windows::Media;</div><div class="line"></div><div class="line">    HWND GetHwnd(HWND parent, int x, int y, int width, int height) &#123;</div><div class="line">    HwndSource^ source = gcnew HwndSource(</div><div class="line">        <span class="number">0</span>, <span class="comment">// class style  </span></div><div class="line">        WS_VISIBLE | WS_CHILD, <span class="comment">// style  </span></div><div class="line">        <span class="number">0</span>, <span class="comment">// exstyle  </span></div><div class="line">        x, y, width, height,</div><div class="line">        <span class="string">"hi"</span>, <span class="comment">// NAME  </span></div><div class="line">        IntPtr(parent)        <span class="comment">// parent window   </span></div><div class="line">    );</div><div class="line"></div><div class="line">    UIElement^ page = gcnew ManagedContent::WPFContent();</div><div class="line">    source-&gt;RootVisual = page;</div><div class="line">    <span class="keyword">return</span> (HWND)source-&gt;Handle.ToPointer();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>and finally  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//managed content</span></div><div class="line">ManagedCode::GetHwnd(hWnd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</div></pre></td></tr></table></figure>
<p>Due to the different technologies behind WPF and GDI, more work needed to be done for the unavoidable alpha blending problem, but, you can use wpf popup to achieve your goal for short. </p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-gaussian_blur_opencl" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/01/02/gaussian_blur_opencl/">使用 OpenCL 实现图片高斯模糊</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/01/02/gaussian_blur_opencl/">
            <time datetime="2018-01-02T05:58:27.000Z" itemprop="datePublished">2018-01-02</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术/">技术</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/OpenCL/">OpenCL</a>, <a class="tag-link" href="/tags/图像处理/">图像处理</a>, <a class="tag-link" href="/tags/高性能计算/">高性能计算</a>, <a class="tag-link" href="/tags/高斯模糊/">高斯模糊</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>高斯模糊（ <a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A" target="_blank" rel="external">https://zh.wikipedia.org/wiki/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A</a> ）是一种常见的图像处理算法，使用高斯分布与图像做卷积，得到模糊的效果。其二维定义：<br><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/c36071d89adc2f4da470b45ce05c33ca93744577" alt=""> </p>
<p>σ是正态分布的标准偏差。在应用的时候，假设σ为2.5。对于模糊半径为1，则高斯矩阵为3*3的一个矩阵，以[1,1]为中心，带入公式计算高斯矩阵的值，得到：  </p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>0.0216996633</td>
<td>0.0235069655</td>
<td>0.0216996633  </td>
</tr>
<tr>
<td>0.0235069655</td>
<td>0.0254647918</td>
<td>0.0235069655  </td>
</tr>
<tr>
<td>0.0216996633</td>
<td>0.0235069655</td>
<td>0.0216996633  </td>
</tr>
</tbody>
</table>
<p>他们的和为 0.206291318，我们需要他们的和为1，因此与总和相除得到：  </p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>0.105189413</td>
<td>0.113950342</td>
<td>0.105189413  </td>
</tr>
<tr>
<td>0.113950342</td>
<td>0.123440929</td>
<td>0.113950342  </td>
</tr>
<tr>
<td>0.105189413</td>
<td>0.113950342</td>
<td>0.105189413  </td>
</tr>
</tbody>
</table>
<p>根据这个矩阵，对图像的每个像素点进行计算，计算的九个点的各rgb分量之和就是最终像素的rgb分量。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//计算高斯矩阵</span></div><div class="line">private <span class="keyword">void</span> ComputeWeightMatrix()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> center = Radius;</div><div class="line">    <span class="keyword">var</span> conBase = <span class="number">2</span> * <span class="built_in">Math</span>.Pow(Variance, <span class="number">2</span>);</div><div class="line">    <span class="keyword">var</span> conRoot = <span class="number">1</span> / (<span class="built_in">Math</span>.PI * conBase);</div><div class="line"></div><div class="line">    float sum = <span class="number">0</span>f;</div><div class="line">    <span class="keyword">for</span> (int x = -Radius; x &lt;= Radius; x++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">for</span> (int y = Radius; y &gt;= -Radius; y--)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">var</span> weight = conRoot * <span class="built_in">Math</span>.Pow(<span class="built_in">Math</span>.E, -(x * x + y * y) / conBase);</div><div class="line">            _matrix[GridPosToArrayIndex(x, y, center, Radius)] = (float)weight;</div><div class="line">            sum += (float)weight;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; _matrix.Length; i++)</div><div class="line">    &#123;</div><div class="line">        _matrix[i] /= sum;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Compute</span></div><div class="line">public <span class="keyword">void</span> Compute(string imageFile)</div><div class="line">&#123;</div><div class="line">    using (<span class="keyword">var</span> bitmap = <span class="keyword">new</span> Bitmap(imageFile))</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> datas = bitmap.LockBits(<span class="keyword">new</span> Rectangle(<span class="keyword">new</span> Point(), <span class="keyword">new</span> Size(bitmap.Width, bitmap.Height)),ImageLockMode.ReadOnly,bitmap.PixelFormat);</div><div class="line">        <span class="keyword">var</span> dataSize = datas.Stride * datas.Height;</div><div class="line">        <span class="keyword">var</span> argbs = <span class="keyword">new</span> byte[dataSize];</div><div class="line">        <span class="keyword">var</span> dsts = <span class="keyword">new</span> byte[dataSize];</div><div class="line">        int matrixWidth = Radius * <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">        Marshal.Copy(datas.Scan0, argbs, <span class="number">0</span>, dataSize);</div><div class="line"></div><div class="line">        Stopwatch sw=Stopwatch.StartNew();</div><div class="line">        <span class="keyword">for</span> (int y = <span class="number">0</span>; y &lt; bitmap.Height; y++)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">for</span> (int x = <span class="number">0</span>; x &lt; bitmap.Width; x++)</div><div class="line">            &#123;</div><div class="line">                float sumA = <span class="number">0</span>;</div><div class="line">                float sumR = <span class="number">0</span>;</div><div class="line">                float sumG = <span class="number">0</span>;</div><div class="line">                float sumB=<span class="number">0</span>;</div><div class="line">                <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; _matrix.Length; i++)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">var</span> pos = transform_pos(x, y, matrixWidth, bitmap.Width, bitmap.Height, Radius, i);</div><div class="line">                    <span class="keyword">var</span> position = pos.Y * datas.Stride + pos.X*<span class="number">4</span>;</div><div class="line">                    sumR += argbs[position] * _matrix[i];</div><div class="line">                    sumG += argbs[position + <span class="number">1</span>] * _matrix[i];</div><div class="line">                    sumB += argbs[position + <span class="number">2</span>] * _matrix[i];</div><div class="line">                    sumA += argbs[position + <span class="number">3</span>] * _matrix[i];</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> dstPos = y * datas.Stride + x * <span class="number">4</span>;</div><div class="line">                dsts[dstPos] = (byte)sumR;</div><div class="line">                dsts[dstPos+<span class="number">1</span>] = (byte)sumG;</div><div class="line">                dsts[dstPos+<span class="number">2</span>] = (byte)sumB;</div><div class="line">                dsts[dstPos+<span class="number">3</span>] = (byte)sumA;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        bitmap.UnlockBits(datas);</div><div class="line"></div><div class="line">        <span class="keyword">var</span> elapse = sw.Elapsed;</div><div class="line">        Console.WriteLine($<span class="string">"Costing: &#123;elapse&#125;"</span>);</div><div class="line">        Debug.WriteLine($<span class="string">"Costing: &#123;elapse&#125;"</span>);</div><div class="line"></div><div class="line">        <span class="keyword">var</span> handle = GCHandle.Alloc(dsts, GCHandleType.Pinned);</div><div class="line">        using (<span class="keyword">var</span> dstBmp = <span class="keyword">new</span> Bitmap(datas.Width, datas.Height, datas.Stride, bitmap.PixelFormat,</div><div class="line">            handle.AddrOfPinnedObject()))</div><div class="line">        &#123;</div><div class="line">            dstBmp.Save(<span class="string">"processed_normal.bmp"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        handle.Free();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然，这样能完成工作，但是耗时太长，对于3000*1920尺寸的图片处理需要2分51秒（Intel Core i7-4770)，这显然是不可接受的。<br>对于这种分别计算每个像素，且各像素间互不干扰的问题，使用OpenCL可以大幅降低时间消耗。  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">    OpenCL 高斯模糊代码</div><div class="line">    Copyright Gandalfliang</div><div class="line">*/ </div><div class="line">inline int2 transform_pos(int centerX,int centerY,int matrixWidth,int radius,int index)</div><div class="line">&#123;</div><div class="line">    int x=index%matrixWidth;</div><div class="line">    int offsetX=x-(radius+<span class="number">1</span>);</div><div class="line">    int y=index/matrixWidth;</div><div class="line">    int offsetY=radius-y;</div><div class="line">    <span class="keyword">return</span> (int2)(centerX+offsetX,centerY-offsetY);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> sampler_t sampler_img=CLK_NORMALIZED_COORDS_FALSE|CLK_ADDRESS_CLAMP_TO_EDGE;</div><div class="line"></div><div class="line"><span class="comment">//opencl kernel 代码</span></div><div class="line">kernel <span class="keyword">void</span> gaussian_blur(</div><div class="line">    read_only image2d_t src,</div><div class="line">    global write_only char* dst,</div><div class="line">    global read_only float* matrix,</div><div class="line">    read_only int radius,</div><div class="line">	read_only int width)</div><div class="line">&#123;</div><div class="line">    int x=get_global_id(<span class="number">0</span>);</div><div class="line">    int y=get_global_id(<span class="number">1</span>);</div><div class="line"></div><div class="line">    float sumR,sumG,sumB,sumA;</div><div class="line">    int matrixWidth=radius*<span class="number">2</span>+<span class="number">1</span>;</div><div class="line">    int matrix_size=pow(matrixWidth,<span class="number">2</span>);</div><div class="line">    <span class="keyword">for</span>(int i=<span class="number">0</span>;i&lt;matrix_size;i++)</div><div class="line">    &#123;</div><div class="line">        int2 pix=transform_pos(x,y,matrixWidth,radius,i);</div><div class="line">        uint4 rgba = read_imageui(src,sampler_img,pix);</div><div class="line">        sumR+=rgba.x*matrix[i];</div><div class="line">        sumG+=rgba.y*matrix[i];</div><div class="line">        sumB+=rgba.z*matrix[i];</div><div class="line">		sumA+=rgba.w*matrix[i];</div><div class="line">    &#125;</div><div class="line">   </div><div class="line">	int loc=y*width*<span class="number">4</span>+x*<span class="number">4</span>;</div><div class="line">	dst[loc]=sumR;</div><div class="line">	dst[loc+<span class="number">1</span>]=sumG;</div><div class="line">	dst[loc+<span class="number">2</span>]=sumB;</div><div class="line">	dst[loc+<span class="number">3</span>]=sumA;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Host代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">public <span class="keyword">void</span> Compute_cl(string imageFile)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//选取设备</span></div><div class="line">    <span class="keyword">var</span> platform = ComputePlatform.Platforms.FirstOrDefault();</div><div class="line">    <span class="keyword">var</span> device = platform.Devices.FirstOrDefault();</div><div class="line">    <span class="comment">//设置相关上下文</span></div><div class="line">    <span class="keyword">var</span> properties = <span class="keyword">new</span> ComputeContextPropertyList(platform);</div><div class="line">    <span class="keyword">var</span> context = <span class="keyword">new</span> ComputeContext(<span class="keyword">new</span>[] &#123;device&#125;, properties, <span class="literal">null</span>, IntPtr.Zero);</div><div class="line">    <span class="comment">//命令队列，用于控制执行的代码</span></div><div class="line">    ComputeCommandQueue commands = <span class="keyword">new</span> ComputeCommandQueue(context, context.Devices[<span class="number">0</span>],</div><div class="line">        ComputeCommandQueueFlags.None);</div><div class="line">    <span class="comment">//读取opencl代码</span></div><div class="line">    <span class="keyword">var</span> code = File.ReadAllText(@<span class="string">"gaussianblur.cl"</span>);</div><div class="line">    <span class="comment">//编译</span></div><div class="line">    <span class="keyword">var</span> program = <span class="keyword">new</span> ComputeProgram(context, code);</div><div class="line">    <span class="keyword">try</span></div><div class="line">    &#123;</div><div class="line">        program.Build(<span class="keyword">new</span>[] &#123;device&#125;, <span class="literal">null</span>, <span class="literal">null</span>, IntPtr.Zero);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (Exception ex)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">throw</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> images = CreateImageFromBitmap(imageFile, context,</div><div class="line">        ComputeMemoryFlags.ReadWrite | ComputeMemoryFlags.CopyHostPointer);</div><div class="line"></div><div class="line">    <span class="comment">//创建核心代码，就是cl代码中以kernel标识的函数</span></div><div class="line">    <span class="keyword">var</span> kernel = program.CreateKernel(<span class="string">"gaussian_blur"</span>);</div><div class="line">    <span class="comment">//矩阵规模</span></div><div class="line">    <span class="comment">//储存计算结果的数组</span></div><div class="line">    </div><div class="line">    <span class="comment">//创建的核心代码函数以这种方式来传参</span></div><div class="line">    <span class="keyword">var</span> resultBuffer=<span class="keyword">new</span> ComputeBuffer&lt;char&gt;(context,ComputeMemoryFlags.WriteOnly, dstBytes.Length);</div><div class="line">    kernel.SetMemoryArgument(<span class="number">0</span>, images);</div><div class="line">    kernel.SetMemoryArgument(<span class="number">1</span>, resultBuffer);</div><div class="line">    kernel.SetMemoryArgument(<span class="number">2</span>, <span class="keyword">new</span> ComputeBuffer&lt;float&gt;(context,ComputeMemoryFlags.ReadOnly|ComputeMemoryFlags.CopyHostPointer,_matrix));</div><div class="line">    kernel.SetValueArgument(<span class="number">3</span>, Radius);</div><div class="line">    kernel.SetValueArgument(<span class="number">4</span>, (int)images.Width);</div><div class="line">    Console.WriteLine($<span class="string">"运行平台: &#123;platform.Name&#125;\n运行设备： &#123;device.Name&#125;\n"</span>);</div><div class="line">    Stopwatch sw = Stopwatch.StartNew();</div><div class="line">    <span class="keyword">var</span> climg = images;</div><div class="line"></div><div class="line">    <span class="comment">//执行代码</span></div><div class="line">    commands.Execute(kernel, <span class="literal">null</span>, <span class="keyword">new</span> long[] &#123;climg.Width, climg.Height&#125;, <span class="literal">null</span>, <span class="literal">null</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//read data</span></div><div class="line">    char[] resultArray = <span class="keyword">new</span> char[dstBytes.Length];</div><div class="line">    <span class="keyword">var</span> arrHandle = GCHandle.Alloc(resultArray, GCHandleType.Pinned);</div><div class="line">    commands.Read(resultBuffer, <span class="literal">true</span>, <span class="number">0</span>, dstBytes.Length, arrHandle.AddrOfPinnedObject(), <span class="literal">null</span>);</div><div class="line">    <span class="comment">//commands.ReadFromImage(images.Item2, processeddata.Scan0, true, null);</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> resultHandle = GCHandle.Alloc(resultArray, GCHandleType.Pinned);</div><div class="line">    <span class="keyword">var</span> bmp=<span class="keyword">new</span> Bitmap(climg.Width,climg.Height, climg.Width*<span class="number">4</span>, PixelFormat.Format32bppArgb, resultHandle.AddrOfPinnedObject());</div><div class="line">    <span class="keyword">var</span> elapsed = sw.Elapsed;</div><div class="line">    Console.WriteLine($<span class="string">"耗时: &#123;elapsed.TotalMilliseconds&#125; ms\n"</span>);</div><div class="line">    kernel.Dispose();</div><div class="line"></div><div class="line">    bmp.Save(<span class="string">"processed_cl.bmp"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>相同尺寸的图片处理，使用 Intel Core i7-4770 自带的核显 HD4600 处理，耗时只需要164毫秒。</p>
<p>以下是相关测试结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">运行平台: Intel(R) OpenCL</div><div class="line">运行设备： Intel(R) HD Graphics 4600</div><div class="line">处理图片尺寸：790*501</div><div class="line">OpenCL处理耗时: 13.6597 ms</div><div class="line"></div><div class="line">处理图片尺寸：790*501</div><div class="line">常规方法耗时: 11482.9402 ms</div><div class="line"></div><div class="line">运行平台: Intel(R) OpenCL</div><div class="line">运行设备： Intel(R) HD Graphics 4600</div><div class="line">处理图片尺寸：1339*693</div><div class="line">OpenCL处理耗时: 33.0095 ms</div><div class="line"></div><div class="line">处理图片尺寸：1339*693</div><div class="line">常规方法耗时: 26908.9926 ms</div><div class="line"></div><div class="line">运行平台: Intel(R) OpenCL</div><div class="line">运行设备： Intel(R) HD Graphics 4600</div><div class="line">处理图片尺寸：1920*1080</div><div class="line">OpenCL处理耗时: 51.3885 ms</div><div class="line"></div><div class="line">处理图片尺寸：1920*1080</div><div class="line">常规方法耗时: 60147.3815 ms</div></pre></td></tr></table></figure></p>
<p>当然，常规方法都只使用了单线程，还未发挥多核CPU的威力，然而，可以预见的是，即使是使用多线程，提升也是有限的。</p>
<p>原图：<br><img src="/2018/01/02/gaussian_blur_opencl/screen_shot_gaus.png" alt="screen_shot_gaus.png" title=""><br>高斯模糊：<br><img src="/2018/01/02/gaussian_blur_opencl/processed_cl.bmp" alt="processed_cl.bmp" title=""></p>
<p>代码： <a href="https://github.com/gandalfliang/cloo_netstandard/tree/temp" target="_blank" rel="external">https://github.com/gandalfliang/cloo_netstandard/tree/temp</a> </p>
<font size="4" color="red">Update: 在nVidia的环境下会导致处理后的图片出现花屏现象，估计是cl代码的问题，又或者是nVidia的驱动有问题？下次再更新</font>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>    
    <a href="#" class="bds_sqq" data-cmd="qzone" title="分享给QQ好友">QQ</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
    </nav>
</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/12/26/csharp-memory-model-part-1/" class="thumbnail">
    
    
        <span style="background-image:url(https://avatars2.githubusercontent.com/u/9141961?s=200&amp;v=4)" alt="C# 内存模型" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <!-- <p class="item-category"><a class="article-category-link" href="/categories/技术/">技术</a></p> -->
                            <p class="item-title"><a href="/2018/12/26/csharp-memory-model-part-1/" class="title">C# 内存模型</a></p>
                            <p class="item-date"><time datetime="2018-12-26T07:43:56.000Z" itemprop="datePublished">2018-12-26</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/08/23/tail-recursion/" class="thumbnail">
    
    
        <span style="background-image:url(https://avatars2.githubusercontent.com/u/9141961?s=200&amp;v=4)" alt="C# 尾递归优化" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <!-- <p class="item-category"><a class="article-category-link" href="/categories/技术/">技术</a></p> -->
                            <p class="item-title"><a href="/2018/08/23/tail-recursion/" class="title">C# 尾递归优化</a></p>
                            <p class="item-date"><time datetime="2018-08-22T16:41:31.000Z" itemprop="datePublished">2018-08-23</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/07/16/filtering-in-business-logic/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <!-- <p class="item-category"></p> -->
                            <p class="item-title"><a href="/2018/07/16/filtering-in-business-logic/" class="title">业务逻辑中的 Filter</a></p>
                            <p class="item-date"><time datetime="2018-07-16T03:50:00.000Z" itemprop="datePublished">2018-07-16</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/06/01/debugging-mlt/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.mltframework.org/assets/img/mlt-logo-128.png)" alt="使用 IDE 编译调试 Mlt framework" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <!-- <p class="item-category"></p> -->
                            <p class="item-title"><a href="/2018/06/01/debugging-mlt/" class="title">使用 IDE 编译调试 Mlt framework</a></p>
                            <p class="item-date"><time datetime="2018-06-01T05:32:41.000Z" itemprop="datePublished">2018-06-01</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/04/17/debug_mlt_vscode/" class="thumbnail">
    
    
        <span style="background-image:url(https://www.mltframework.org/assets/img/mlt-logo-128.png)" alt="Debug Mlt Framework in VSCode" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <!-- <p class="item-category"><a class="article-category-link" href="/categories/图片/">图片</a></p> -->
                            <p class="item-title"><a href="/2018/04/17/debug_mlt_vscode/" class="title">Debug Mlt Framework in VSCode</a></p>
                            <p class="item-date"><time datetime="2018-04-16T17:21:38.000Z" itemprop="datePublished">2018-04-17</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/图片/">图片</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/摄影/">摄影</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a><span class="category-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BUG/">BUG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CLOO/">CLOO</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/D3DImage/">D3DImage</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DirectX/">DirectX</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Extension/">Extension</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FFmpeg/">FFmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/">GPU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Guangzhou/">Guangzhou</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LayeredWindow/">LayeredWindow</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mlt-Framework/">Mlt Framework</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET-Standard/">NET Standard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nikon/">Nikon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCL/">OpenCL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perforator/">Perforator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/">Performance</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Profiling/">Profiling</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Timelapse/">Timelapse</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/">VSCode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Video/">Video</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Visual-Studio/">Visual Studio</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Volatile/">Volatile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WPF/">WPF</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xcode/">Xcode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async-await/">async/await</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-pattern/">design pattern</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/">filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存模型/">内存模型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单反/">单反</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图像处理/">图像处理</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/尾递归/">尾递归</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/曼德博集合/">曼德博集合</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/渲染/">渲染</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/解码/">解码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/通用计算/">通用计算</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/音视频/">音视频</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高性能计算/">高性能计算</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高斯模糊/">高斯模糊</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/BUG/" style="font-size: 10px;">BUG</a> <a href="/tags/C/" style="font-size: 12.5px;">C#</a> <a href="/tags/CLOO/" style="font-size: 12.5px;">CLOO</a> <a href="/tags/D3DImage/" style="font-size: 12.5px;">D3DImage</a> <a href="/tags/DirectX/" style="font-size: 17.5px;">DirectX</a> <a href="/tags/Extension/" style="font-size: 12.5px;">Extension</a> <a href="/tags/FFmpeg/" style="font-size: 10px;">FFmpeg</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/Guangzhou/" style="font-size: 10px;">Guangzhou</a> <a href="/tags/LayeredWindow/" style="font-size: 12.5px;">LayeredWindow</a> <a href="/tags/Mlt-Framework/" style="font-size: 12.5px;">Mlt Framework</a> <a href="/tags/NET-Standard/" style="font-size: 10px;">NET Standard</a> <a href="/tags/Nikon/" style="font-size: 10px;">Nikon</a> <a href="/tags/OpenCL/" style="font-size: 17.5px;">OpenCL</a> <a href="/tags/Perforator/" style="font-size: 10px;">Perforator</a> <a href="/tags/Performance/" style="font-size: 12.5px;">Performance</a> <a href="/tags/Profiling/" style="font-size: 10px;">Profiling</a> <a href="/tags/Timelapse/" style="font-size: 10px;">Timelapse</a> <a href="/tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="/tags/Video/" style="font-size: 10px;">Video</a> <a href="/tags/Visual-Studio/" style="font-size: 15px;">Visual Studio</a> <a href="/tags/Volatile/" style="font-size: 10px;">Volatile</a> <a href="/tags/WPF/" style="font-size: 20px;">WPF</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/async-await/" style="font-size: 10px;">async/await</a> <a href="/tags/design-pattern/" style="font-size: 10px;">design pattern</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/内存模型/" style="font-size: 10px;">内存模型</a> <a href="/tags/单反/" style="font-size: 10px;">单反</a> <a href="/tags/图像处理/" style="font-size: 12.5px;">图像处理</a> <a href="/tags/尾递归/" style="font-size: 10px;">尾递归</a> <a href="/tags/曼德博集合/" style="font-size: 10px;">曼德博集合</a> <a href="/tags/渲染/" style="font-size: 12.5px;">渲染</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/解码/" style="font-size: 10px;">解码</a> <a href="/tags/通用计算/" style="font-size: 10px;">通用计算</a> <a href="/tags/音视频/" style="font-size: 10px;">音视频</a> <a href="/tags/高性能计算/" style="font-size: 15px;">高性能计算</a> <a href="/tags/高斯模糊/" style="font-size: 10px;">高斯模糊</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
                    <li>
                        <a href="http://lindexi.oschina.io/">林德熙的博客</a>
                    </li>
                
                    <li>
                        <a href="https://walterlv.github.io/blog/">吕毅的博客</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019 gandalfliang<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        

    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>